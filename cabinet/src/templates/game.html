<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>The Splunk Arcade!</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />

        <link rel="shortcut icon" href="{{ url_for('static', filename='images/favicon.ico')}}">

        <link rel="stylesheet" href="{{ url_for('static', filename='css/output.css')}}">

        <script src="http://code.jquery.com/jquery-latest.js"></script>

        <script>
            function fetchQuestion() {
                $.ajax({
                    type: 'GET',
                    url: '{{ url_for("routes.get_question", module=data.title) }}',
                    success: function(response) {
                        var question = response.question;
                        var A = response.A;
                        var B = response.B;
                        var C = response.C;
                        var D = response.D;
                        var answer = response.answer;

                        $('div.question').append(question);
                        $('#OptionA').append(A);
                        $('#OptionB').append(B);
                        $('#OptionC').append(C);
                        $('#OptionD').append(D);

                        window.correctAnswer = answer;
                    },
                    error: function(error) {
                        console.log(error);
                    }
                });
            }

            function checkQuestionAnswer() {
                const choices = document.getElementsByName('options');
                let selectedValue;

                for (const choice of choices) {
                    if (choice.checked) {
                        selectedValue = choice.value;
                        break;
                    }
                }

                if (selectedValue) {
                    if (selectedValue === window.correctAnswer) {
                        alert('Correct!');
                    } else {
                        alert(`Incorrect. The correct answer is: ${window.correctAnswer}`);
                    }
                } else {
                    alert('Please select an answer before submitting.');
                }
            }
        </script>
    </head>
    <body class="flex flex-col bg-gray-800 bg-cover bg-center" style="background-image: url('{{ url_for('static', filename='images/arcade_bg.png') }}');">
        <header>
            <img src="{{ url_for('static', filename='images/arcade__.png')}}" class="mx-auto h-52">
        </header>

        <nav class=" text-white">
            <ul class="flex justify-center space-x-2">
                <li><a href="{{ url_for('routes.home') }}"><img src="{{ url_for('static', filename='images/home_.png')}}" class="mx-auto h-14"></a></li>
                <li><a href="{{ scoreboard_endpoint }}"><img src="{{ url_for('static', filename='images/scoreboard_.png')}}" class="mx-auto h-14"></a></li>
                <li><a href="{{ logout_endpoint }}"><img src="{{ url_for('static', filename='images/logout_.png')}}" class="mx-auto h-14"></a></li>
            </ul>
        </nav>

        <main class="relative py-4 opacity-90 bg-gray-800 p-8 flex flex-col">
            <div class="flex items-center justify-between bg-gray-800 text-white px-4 py-2">
                <button
                        id="open-left-drawer-btn"
                        class="bg-gray-700 hover:bg-gray-600 text-white py-2 px-4 rounded-lg shadow-lg"
                        onclick="toggleDrawer('left')"
                >
                    Toggle Content
                </button>

                <div class="flex-1 text-center text-sm leading-tight">
                    <span id="game-metadata"></span>
                </div>

                <button
                        id="open-right-drawer-btn"
                        class="bg-gray-700 hover:bg-gray-600 text-white py-2 px-4 rounded-lg shadow-lg"
                        onclick="toggleDrawer('right')"
                >
                    Toggle Quiz
                </button>
            </div>

            <div class="flex h-auto">
                <div class="w-1/12 flex items-center justify-center">
                </div>

                <div id="game-container" class="w-10/12 p-4 flex flex-col h-auto">
                    {% block content %}
                    {% if "imvader" in data.title %}
                    {% include 'cabinets/imvader.html' %}
                    {% endif %}
                    {% if "logger" in data.title %}
                    {% include 'cabinets/logger.html' %}
                    {% endif %}
                    {% endblock %}
                </div>

                <div class="w-1/12 flex items-center justify-center">
                </div>
            </div>

            <div
                    id="left-drawer"
                    class="absolute left-0 w-64 bg-gray-800 text-white shadow-lg transform -translate-x-full transition-transform duration-300 z-50 h-full"
                    style="top: 4rem;"
            >
                <ul class="p-4 space-y-2">
                    <!-- Walkthrough content -->
                    <div class="walkthrough" id="walkthrough"></div>
                </ul>

                <!-- Navigation arrows -->
                <div class="flex justify-between items-center p-4 border-t border-gray-700">
                    <button
                            id="prev-stage"
                            class="bg-gray-700 hover:bg-gray-600 text-white py-2 px-4 w-15 rounded-lg"
                    >
                        ←
                    </button>
                    <button
                            id="next-stage"
                            class="bg-gray-700 hover:bg-gray-600 text-white py-2 px-4 w-15 rounded-lg"
                    >
                        →
                    </button>
                </div>
            </div>

            <div
                    id="right-drawer"
                    class="absolute right-0 w-64 bg-gray-800 text-white shadow-lg transform translate-x-full transition-transform duration-300 z-50 h-full"
                    style="top: 4rem;"
            >
                <ul class="p-4">
                    <div class="question" id="question"></div>
                    <ul class="choices">
                        <li>
                            <label id="OptionA">
                                <input type="radio" name="options" value="A"> A)
                            </label>
                        </li>
                        <li>
                            <label id="OptionB">
                                <input type="radio" name="options" value="B"> B)
                            </label>
                        </li>
                        <li>
                            <label id="OptionC">
                                <input type="radio" name="options" value="C"> C)
                            </label>
                        </li>
                        <li>
                            <label id="OptionD">
                                <input type="radio" name="options" value="D"> D)
                            </label>
                        </li>
                    </ul>
                    <button type="button" onclick="checkQuestionAnswer()">Submit</button>
                </ul>
            </div>
        </main>

        <script>
            function toggleDrawer(side) {
                const leftDrawer = document.getElementById('left-drawer');
                const rightDrawer = document.getElementById('right-drawer');

                if (side === 'left') {
                    leftDrawer.classList.toggle('-translate-x-full');
                } else if (side === 'right') {
                    rightDrawer.classList.toggle('translate-x-full');
                }
            }
        </script>
        <script>
            /// this keeps the arrow keys from scrolling the page when playing a game
            const gameContainer = document.getElementById("game-container");

            gameContainer.addEventListener("keydown", function (event) {
                if (["ArrowUp", "ArrowDown", "ArrowLeft", "ArrowRight"].includes(event.key)) {
                    event.preventDefault();
                }
            });

            gameContainer.setAttribute("tabindex", "0");
            gameContainer.style.outline = "none";
            gameContainer.focus();
        </script>
        <script>
            // we want to disable scrolling (horizontally) so users dont see the "hidden" content panels
            document.body.style.overflowX = "hidden";
        </script>

        <script>
            let currentStage = 1;

            function fetchWalkthroughStage(stage) {
                $.ajax({
                    type: "GET",
                    url: "{{ url_for('routes.get_walkthrough', module=data.title, stage='') }}" + stage,
                    success: function (response) {
                        console.log("RESPONSE > ", response);
                        const walkthroughElement = document.getElementById("walkthrough");

                        if (!walkthroughElement) {
                            console.error("Walkthrough element not found");
                            return;
                        }

                        walkthroughElement.innerHTML = "";

                        // title; replace w/ actual title/content when service is updated to
                        // return that ;p
                        const t = document.createElement("span");
                        t.className = "mr-4";
                        t.innerHTML = `<strong>${response.module}</strong>`;
                        walkthroughElement.appendChild(t);

                        const c = document.createElement("span");
                        c.className = "mr-4";
                        c.innerHTML = `<strong>${response.stage}</strong>`;
                        walkthroughElement.appendChild(c);
                    },
                    error: function (error) {
                        console.error("Error fetching walkthrough stage:", error);
                    },
                });
            }

            function setupWalkthroughNavigation() {
                const prevButton = document.getElementById("prev-stage");
                const nextButton = document.getElementById("next-stage");

                if (prevButton && nextButton) {
                    prevButton.onclick = function () {
                        if (currentStage > 1) {
                            currentStage--;
                            fetchWalkthroughStage(currentStage);
                        } else {
                            alert("You're already at the first stage!");
                        }
                    };

                    nextButton.onclick = function () {
                        currentStage++;
                        fetchWalkthroughStage(currentStage);
                    };
                }
            }

            document.addEventListener("DOMContentLoaded", function () {
                fetchWalkthroughStage(currentStage);
                setupWalkthroughNavigation();
            });
        </script>

        <footer class="mt-auto bg-gray-800 opacity-90 text-white p-4 text-center">
            <p>Made with ❤️ by <a href="https://www.splunk.com" target="_blank" class="text-blue-400 hover:text-blue-500">Splunk</a></p>
        </footer>
    </body>
</html>